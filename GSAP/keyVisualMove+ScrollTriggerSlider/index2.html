<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
    </head>
    <body>
        <script>
            $(function () {
                gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

                let isScrolling = false; // 스크롤 중인지 여부를 저장하는 변수

                function disableScroll() {
                    // 스크롤을 비활성화
                    document.body.style.overflow = 'hidden';
                    window.addEventListener('wheel', preventDefault, { passive: false });
                    window.addEventListener('scroll', preventDefault, { passive: false });
                    window.addEventListener('touchmove', preventDefault, { passive: false });
                }

                function enableScroll() {
                    // 스크롤을 활성화
                    document.body.style.overflow = '';
                    window.removeEventListener('wheel', preventDefault);
                    window.removeEventListener('scroll', preventDefault);
                    window.removeEventListener('touchmove', preventDefault);
                }

                function preventDefault(e) {
                    e.preventDefault();
                }

                function goToSection(i) {
                    if (isScrolling) return; // 이미 스크롤 중이라면 종료

                    isScrolling = true; // 스크롤 시작
                    disableScroll(); // 스크롤 비활성화

                    gsap.to(window, {
                        scrollTo: { y: i * window.innerHeight, autoKill: false },
                        duration: 1,
                        ease: 'expo.inOut',
                        onComplete: () => {
                            isScrolling = false; // 스크롤 완료
                            enableScroll(); // 스크롤 활성화
                        },
                    });
                }

                gsap.utils.toArray('.about-section').forEach((panel, i) => {
                    ScrollTrigger.create({
                        trigger: panel,
                        start: 'top top',
                        end: 'bottom top',
                        scrub: 1,
                        onEnter: () => goToSection(i + 1), // 다음 섹션으로 이동
                        onEnterBack: () => goToSection(i), // 이전 섹션으로 돌아가기
                        markers: true, // Enable markers for debugging
                    });
                });

                let cards = gsap.utils.toArray('.prdslider ul li');
                let cardsWidth = 0;

                function calcCardsWidth() {
                    cards.forEach((item) => {
                        cardsWidth += $(item).outerWidth(true);
                    });
                }
                calcCardsWidth();

                if (cardsWidth > $('.prdslider').innerWidth()) {
                    let timeline = gsap.timeline({
                        scrollTrigger: {
                            trigger: '.box2',
                            start: 'center center',
                            pin: true,
                            scrub: 1,
                            end: () => '+=' + (cardsWidth - $('.prdslider').outerWidth(true)) + 'px',
                            invalidateOnRefresh: true,
                            markers: true,
                        },
                    });

                    timeline.to(cards, {
                        x: () => -(cardsWidth - $('.prdslider').outerWidth(true)) + 'px',
                        ease: 'none',
                    });
                }

                ScrollTrigger.addEventListener('refreshInit', function () {
                    cardsWidth = 0;
                    calcCardsWidth();
                });
            });
        </script>
    </body>
</html>
